<html>
<body>
  <h1>My frontend</h1>
  <p>The URL to the backend is: <input id="backendUrl" value="missing backend url"></p>
  
  <p>How did it get there? This front-end runs node, and node looks for a specific environment variable.</p>

  <h2>Run a HTTP request</h2>
  <p>Click the button below to do a request to the backend:</p>
  <button id="reqBtn" onclick="doRequest()">Do a GET to above URL</button>

  <p>If it doesn't work, open your browser's console for more details.</p>

  <p>Backend answer:</p>
  <p id="backendAnswer">(nothing received yet)</p>

  <br/>

  <p>To verify that running a HTTP request works, type /hello in the box
  above, and do a request. (It runs a request to the Node server running this front-end.)</p>

  <script>
    getBackendUrl();

    function getBackendUrl() {
      httpRequest = new XMLHttpRequest()
      httpRequest.open('GET', '/backendurl')

      httpRequest.onreadystatechange = function(){
        // Process the server response here.
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
          if (httpRequest.status === 200) {
            console.log("Found backend URL: " + httpRequest.responseText);
            document.getElementById("backendUrl").value = httpRequest.responseText;
          } else {
            alert('There was a problem getting the backend URL.');
            console.log(httpRequest);
          }
        }
      }

      httpRequest.send();
    }

    function doRequest() {
      var backendUrl = document.getElementById("backendUrl").value;

      httpRequest = new XMLHttpRequest()
      httpRequest.open('GET', backendUrl)

      httpRequest.onreadystatechange = function(){
        // Process the server response here.
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
          if (httpRequest.status === 200) {
            console.log("Got response from backend: " + httpRequest.responseText);
            document.getElementById("backendAnswer").innerHTML = httpRequest.responseText;
          } else {
            console.log("Ajax call to backend failed:");
            console.log(httpRequest);
          }
        }
      }

      httpRequest.send();
    }

  </script>
</body>
</html>